{% extends 'muebles/barnav.html' %}
{% block titulo %}Preguntas Frecuentes{% endblock %}

{% block contenedor %}
<div class="container my-5">
    <h1 class="text-center mb-5">Preguntas Frecuentes</h1>
    
    <div class="row justify-content-center">
        <div class="col-md-8">
            {% if preguntas %}
            <div class="accordion" id="faqAccordion">
                {% for pregunta in preguntas %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="heading{{ pregunta.id }}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                data-bs-target="#collapse{{ pregunta.id }}" aria-expanded="false" 
                                aria-controls="collapse{{ pregunta.id }}">
                            {{ pregunta.pregunta }}
                            <span class="badge bg-primary ms-2">{{ pregunta.votos }} votos</span>
                        </button>
                    </h2>
                    <div id="collapse{{ pregunta.id }}" class="accordion-collapse collapse" 
                         aria-labelledby="heading{{ pregunta.id }}" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            {{ pregunta.respuestas.first.respuesta|linebreaks }}
                            <div class="mt-3">
                                <button class="btn btn-sm btn-outline-primary votar-btn" 
                                        data-pregunta-id="{{ pregunta.id }}">
                                    <i class="fas fa-thumbs-up"></i> Útil ({{ pregunta.votos }})
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="alert alert-info">
                No hay preguntas frecuentes disponibles.
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    $('.votar-btn').click(function() {
        const preguntaId = $(this).data('pregunta-id');
        const btn = $(this);
        
        $.ajax({
            url: '{% url "votar_pregunta" 0 %}'.replace('0', preguntaId),
            method: 'POST',
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function(response) {
                btn.text('Útil (' + response.votos + ')');
            }
        });
    });
});
</script>
{% endblock %}